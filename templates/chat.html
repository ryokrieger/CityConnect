<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat with {{ friend_name }} - CityConnect</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/users/chat.css') }}">
</head>
<body>
    <div class="header">
        <a href="{{ url_for('view_friends') }}">‚Üê Back to Friends</a>
    </div>

    <div class="container">
        <h2>Chat with {{ friend_name }}</h2>

        <!-- Scrollable message history container -->
        <div class="chat-box" id="chat-box">
            <!-- Loop through all messages and display with appropriate styling -->
            {% for message in messages %}
                <!-- Determine if message was sent by current user or received from friend -->
                <div class="chat-message {% if message.sender_ID == current_user_id %}sent{% else %}received{% endif %}">
                    <div class="sender-name">{{ message.sender_name }}</div>

                    <div class="message-content">
                        {{ message.content }}
                    </div>

                    <div class="message-time">{{ message.timestamp }}</div>
                </div>
            {% endfor %}
        </div>

        <!-- Form for sending new messages -->
        <form method="POST">
            <!-- Message input field -->
            <textarea name="message" rows="3" placeholder="Type your message..." required></textarea>
            <button type="submit">Send Message</button>
        </form>
    </div>

    <!-- JavaScript to auto-scroll to bottom of chat on page load -->
    <script>
        // Function to scroll chat to bottom
        function scrollToBottom() {
            const chatBox = document.getElementById('chat-box');
            chatBox.scrollTop = chatBox.scrollHeight;
        }
        
        // Scroll to bottom when page loads
        window.addEventListener('load', scrollToBottom);
        
        // Optional: Scroll to bottom after form submission
        // This helps ensure new messages are visible
        if (window.location.search.includes('message_sent')) {
            scrollToBottom();
        }
    </script>
</body>
</html>